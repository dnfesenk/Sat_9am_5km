# frozen_string_literal: true

active_admin_form_for [:admin, resource] do |f|
  f.semantic_errors(*f.object.errors.attribute_names)
  columns do
    column do
      athlete_id = params.dig(:volunteer, :athlete_id)
      if athlete_id.present?
        inputs do
          h2 Athlete.find(athlete_id).name
          f.hidden_field :athlete_id, value: athlete_id
        end
      else
        inputs 'Номер волонтёра-участника в системе Parkrun (только цифры)' do
          text_field_tag :parkrun_code, params[:parkrun_code].presence || f.object.athlete&.parkrun_code,
                         placeholder: 'Parkrun ID', style: 'width: 10rem; margin-left: 1rem;'
        end
      end
    end
    column do
      last_activities_collection = Activity.includes(:event).order(date: :desc).last(30).map do |a|
        [human_activity_name(a), a.id]
      end
      if f.object.activity.present? && last_activities_collection.exclude?(f.object.activity.id)
        last_activities_collection << [human_activity_name(f.object.activity), f.object.activity.id]
      end
      inputs do
        input :activity, collection: last_activities_collection
        input :role
      end
    end
  end
  actions
end
